<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="stylesheet.css" type="text/css" charset="utf-8">
<script type="text/javascript" src="jquery-1.7.1.js"></script>
<script type="text/javascript" src="DatabaseList.js"></script>
<script type="text/javascript">
var curStage = 0;
var task_assigned = Math.floor(Math.random() * 2);
var isTestMode = 1; /*change to 1 when publish it on MTurk*/

function basicPopup(url)
{
	popupWindow = window.open(url, "popupWindow");
}

function gup(name, tmpURL)
{
	var regexS = "[\\?&]"+name+"=([^&#]*)";
	var regex = new RegExp(regexS);
	var results = regex.exec(tmpURL);
	if (results == null)
	{
		return "";
	}
	else
	{
		return results[1];
	}
}

function updateMainMenu(expStage)
{
	curStage = expStage;
	switch(expStage)
	{
	
		case 0:
			$("#instruction").text("Click button to fill out a demographic survey");
			$("#instruction").show();
			$("#myButton").show();
			break;
		case 1:
			curStage = expStage;
			$("#instruction").text("Click button to start main task");
			break;
		case 2:
			curStage = expStage;
			$("#instruction").hide();
			$("#myButton").hide();
			$("#mturk_form").show();
			break;
	}
}

$(document).ready(function(){
	$("#mturk_form").hide();
	
	var flag = isTestMode;
	
	if (flag > 0)
	{
		document.getElementById("assignmentId").value=gup("assignmentId", document.referrer);
		document.getElementById("hitId").value=gup("hitId", document.referrer);
		document.getElementById("workerId").value=gup("workerId", document.referrer);
		if (document.getElementById("assignmentId").value == "" || document.getElementById("assignmentId").value=="ASSIGNMENT_ID_NOT_AVAILABLE")
		{
			flag = 1;
		}
		else
		{
			flag = 0;
		}
	}
	
	
		if (flag > 0)
		{
			$("#instruction").text("Please accept HIT first");
			$("#myButton").hide();
		}	
		else
		{
			$("#myButton").click(function(){
				switch(curStage)
				{
					case 0:

						basicPopup("Demographics.html");
						break;
					case 1:
						if (task_assigned == 0)
						{
							basicPopup("Ratings.html");
						}
						else
						{
							basicPopup("SameDifferent.html");
						}
						
						break;
				}
			});
			updateMainMenu(0);
		}

	
});
</script>
</head>
<body>
	<table>
		<tr>
			<td>
			<p style="font-family: arial; font-size: 30px">Please keep this window open at all times until you submit this HIT.</p>
			<p style="font-family: arial; font-size: 30px"> Expect about 10 minutes to finish this HIT. </p>
				<br>
				<p id="instruction" style="font-family: arial; font-size: 30px">Please click the button to start</p>
				<button id="myButton" style="font-family: arial; font-size: 30px">Click</button>
				<form id="mturk_form" method="POST" action="/~shaofang/cgi-bin/DataHandler.php" enctype="multipart/form-data"> <!--change action path to your own DataHandler.php-->
					<input type="hidden" id="assignmentId" name="assignmentId" value="1">
					<input type="hidden" id="hitId" name="hitId" value="">
					<input type="hidden" id="workerId" name="workerId" value="">
					<input type="hidden" id="#demographics" name="#demographics" value=""> <!--this is for saving demo info (check demo.html)-->
					<input type="hidden" id="Ratings" name="Ratings" value=""><!--this is for saving ratings (check Ratings.html)-->
					<input type="hidden" id="SameDifferent" name="SameDifferent" value=""><!--this is for saving SameDifferent (check SameDifferent.html)-->
					<input type="hidden" id="ExpName" name="ExpName" value="Calibration_01"> <!--name of the folder of the data on your server -->
					<p style="font-family: Arial; color: black; font-size: 24px">Click the button to submit HIT. You should see a confirmation code on the new page. </p>
					<p style="font-family: Arial; color: black; font-size: 24px"> Please enter the confirmation code to submit your HIT to Mturk.</p>
					<input id="submitButton" type="submit" name="Finish" value="Submit">
				</form>
			</td>
		</tr>
	</table>
</body>
</html>